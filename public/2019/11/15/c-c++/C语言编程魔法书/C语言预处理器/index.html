<!DOCTYPE html>
<html>

  <head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
    <title>
      
        C语言预处理器 |
          
            Bright的个人博客
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/css/reset.css">
      <link rel="stylesheet" href="/css/style.css">
        <link rel="stylesheet" href="/css/github-markdown.css">
          <link rel="stylesheet" href="/css/atom-one-dark.css">
            
</head>

    <body>
      
        <header id="header" class="card">
  <span class="logo">B</span>
  <span class="motto">技术 & 梦想 |&nbsp;学习 & 总结</span>
  <nav>
    <ul>
    
      <li>
        <a href="/">首页 </a>
      </li>
    
      <li>
        <a href="/archives">归档 </a>
      </li>
    
      <li>
        <a href="/categories">分类 </a>
      </li>
    
      <li>
        <div class="search-input">
          <i class="fa search"></i>
          <input id="search-input" type="text">
        </div>
      </li>
    </ul>
  </nav>
</header>
          <main id="main">
            
              
<aside id="left-sidebar" class="margin-right">
  <nav class="card sidebar-component">
  <div class="card-title">文章归档</div>
  <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a><span class="archive-list-count">21</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a><span class="archive-list-count">16</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">18</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a><span class="archive-list-count">2</span></li></ul>
</nav>
  <nav class="card sidebar-component">
  <div class="card-title">文章分类</div>
  <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/css/">css</a><span class="category-list-count">9</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/css/css基础/">css基础</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/css/css工具/">css工具</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/css/less/">less</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/css/sass/">sass</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/html5/">html5</a><span class="category-list-count">8</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/html5/dom/">dom</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/html5/html5-API/">html5 API</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/html5/html5标签和属性/">html5标签和属性</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/html5/svg/">svg</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/html5/tips/">tips</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/html5/实战/">实战</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/js/js基础/">js基础</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/typescript/">typescript</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/nginx/">nginx</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/node-js/">node.js</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/node-js/npm/">npm</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/node-js/命令行工具/">命令行工具</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/php/">php</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/typescript/">typescript</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/typescript/踩坑指南/">踩坑指南</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/">vue</a><span class="category-list-count">10</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/vue/cli/">cli</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/tips/">tips</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/vue-router/">vue-router</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/vue实战/">vue实战</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/基础/">基础</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/webpack/">webpack</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/webpack/webpack基础/">webpack基础</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/xml/">xml</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/xml/基础/">基础</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/学习打卡/">学习打卡</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全/">安全</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/安全/密码技术/">密码技术</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/操作系统/">操作系统</a><span class="category-list-count">7</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/操作系统/shell/">shell</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/操作系统/ucore/">ucore</a><span class="category-list-count">5</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/mysql/">mysql</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/sql语句/">sql语句</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构/">数据结构</a><span class="category-list-count">6</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构/二叉树/">二叉树</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构/图/">图</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构/链表/">链表</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/算法/模式匹配/">模式匹配</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/深度优先搜索/">深度优先搜索</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程语言/">编程语言</a><span class="category-list-count">14</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/编程语言/C/">C</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/编程语言/C/语言/">语言</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程语言/C语言/">C语言</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程语言/java/">java</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/英语/">英语</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/英语/生词/">生词</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机网络/">计算机网络</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/计算机网络/wireshark/">wireshark</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a><span class="category-list-count">5</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/交给子类/">交给子类</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/生成实例/">生成实例</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/适应设计模式/">适应设计模式</a><span class="category-list-count">2</span></li></ul></li></ul>
</nav>
  <nav class="card sidebar-component">
  <div class="card-title">最近文章</div>
  <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/11/19/c-c++/C语言编程魔法书/8.C语言中的函数/">8.C语言中的函数</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/19/c-c++/C语言编程魔法书/7.C语言中的控制流语句/">7.C语言中的控制流语句</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/18/c-c++/C语言编程魔法书/6.C语言中的指针和数组/">6.C语言中的指针和数组</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/18/c-c++/C语言编程魔法书/C语言标准库/">C语言标准库</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/17/c-c++/C语言编程魔法书/5.C语言的字节对齐和字节填充/">5.C语言的字节对齐和字节填充</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/15/c-c++/C语言编程魔法书/C语言预处理器/">C语言预处理器</a></li></ul>
</nav>
</aside>


                <!--
<aside id="right-sidebar">
  <nav class="card margin-bottom">
  
</nav>
</aside>

-->
                <article id="article markdown-body" class="margin-right">
                  <article class="post-article">
  <h1>
    C语言预处理器
  </h1>
  <hr>
  <p>C语言编译器前端还分为预处理阶段和编译阶段。预处理阶段是通过C语言的各类预处理器将指定的一些字符符号直接替换到即将编译的源代码。<strong>通过预处理器可以在不同的平台上插入不同的代码，还可以将某些代码抽象成宏定义</strong>。</p>
<p>C语言的三大类预处理指示符：</p>
<ul>
<li>条件段预处理</li>
<li>控制行预处理，例如宏定义</li>
<li>空指示符</li>
</ul>
<p>这篇文章学习条件预处理、文件包含、宏替换、行控制、错误指示符、编译指示符(pragma)、空指示符以及C11标准中定义的宏名。</p>
<p>对于预处理指令有一些规则：</p>
<ul>
<li>对于任意一条预处理指示符，除了_Pragma之外，其他的必须以#开头，并且#必须出现在每一行的最前面（#前面可以有空白字符）。</li>
<li>预处理指令无需加分号</li>
<li>有范围的预处理器的范围是起始指示符的下一行到结束指示符的上一行</li>
</ul>
<h2 id="宏定义"><a href="#宏定义" class="headerlink" title="宏定义"></a>宏定义</h2><p>宏定义属于<code>控制行预处理指示符</code>。以<code>#define</code>定义的一个符号称为宏。</p>
<p>C语言的宏定义由两种方式：类似对象的宏定义以及类似函数的宏定义。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类似对象的宏定义</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> 标识符 替换列表 换行符</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 类似函数的宏定义</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> 标识符(参数列表) 替换列表 换行符</span></span><br></pre></td></tr></table></figure></p>
<p><strong>宏定义用于将标识符替换位替换列表中的内容，其作用范围是从它定义完的那个位置起一直到当前源文件结束。</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 下面是宏定义部分的代码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MY_MACRO</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MY_MACRO1 100</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MY_MACRO2 10 + a</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个宏，宏的内容是一个函数</span></span><br><span class="line"><span class="comment">// 如果代码较长，通过\+换行符表示单行</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MY_MACRO3 static int Foo(void) &#123;\</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;\</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 预处理时会替换，相当于定义了一个函数</span></span><br><span class="line">MY_MACRO3</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义了一个宏函数，交换两个实参的值</span></span><br><span class="line"><span class="comment">// MY_SWAP与(之间没有空格</span></span><br><span class="line"><span class="comment">// 这里假定x和y都是整数类型</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MY_SWAP(x, y) &#123; int temp = x; x = y; y = temp; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Dummy</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 两个点：</span></span><br><span class="line">  <span class="comment">// 1.有空格，不是宏函数而是宏对象</span></span><br><span class="line">  <span class="comment">// 2.尽管在函数中定义但是作用范围是其后的整个文件</span></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">define</span> MY_MACRO4 (a,b)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">  <span class="comment">// MY_MACRO不包含任何替换符号，会被忽略</span></span><br><span class="line">  <span class="keyword">int</span> a = MY_MACRO MY_MACRO2;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 变成10+a*3</span></span><br><span class="line">  <span class="keyword">int</span> b = MY_MACRO2 * <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"a = %d, b = %d\n"</span>, a, b);</span><br><span class="line">  <span class="comment">// a = 10, b = 40</span></span><br><span class="line"></span><br><span class="line">  a = Foo();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"a = %d\n"</span>, a);</span><br><span class="line">  <span class="comment">// a = 1</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 替换成&#123; int temp = a; a = b; b = temp; &#125;</span></span><br><span class="line">  MY_SWAP(a, b)</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"a = %d, b = %d\n"</span>, a, b);</span><br><span class="line">  <span class="comment">// a = 40 b = 1</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 替换成a = (a, b)</span></span><br><span class="line">  a = MY_MACRO4;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 这里会输出ok</span></span><br><span class="line">  <span class="keyword">if</span> (a == b) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"ok\n"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在预编译阶段会替换宏定义，同时会合并空白符。</p>
<p>在编译器命令行中也可以使用宏定义，例如-D MY_MACRO=100.</p>
<p>要点：</p>
<ul>
<li>不管是宏对象还是宏函数都是单行的。如果多行需要\</li>
<li>宏函数标识符与(之间不能有空格</li>
<li>宏定义作用域整个文件</li>
<li>宏定义直接替换，在编译之前</li>
<li>替换列表中的前后空白会忽略，但是中间的空白会保留</li>
<li><strong>宏函数中参数的所有空白（包括前后空白）都会保留，#操作符会忽略前后空白</strong></li>
</ul>
<h3 id="宏定义中的-操作符"><a href="#宏定义中的-操作符" class="headerlink" title="宏定义中的#操作符"></a>宏定义中的#操作符</h3><p>要点：</p>
<ul>
<li>#用于宏函数定义</li>
<li>#后面接形参名（#和名字之间可有空格），表示将其内容作为<strong>字符串字面量</strong>表示</li>
<li>预处理符号不同于C语言的标识符，可以作为预处理符号的如下：<ul>
<li>头文件名</li>
<li>标识符</li>
<li>预处理数字</li>
<li>字符常量</li>
<li>字符串常量</li>
<li>标点符号</li>
<li>所有非空白符号，并且不是上面的符号</li>
<li><strong>上述所有内容包括标点字符都会保留，但是不能只出现一个’或者”的情况</strong></li>
</ul>
</li>
<li>宏函数前面的参数可以忽略，置空用逗号隔开</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 宏定义中的#操作符</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MY_MAFUC(x) #x</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MY_MAFUC2(x, y) #x <span class="meta-string">"\n"</span> #y</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sharp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span>* s =MY_MAFUC(<span class="number">10</span>ab);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"this literal is %s\n"</span>, s); </span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">strcmp</span>(s, <span class="string">"10ab"</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Equal!"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 对于#操作的实参的空白符，前后空白符都会被删除</span></span><br><span class="line">  <span class="comment">// 同时"\"会被替换成"\\"，"和'等也会被转义</span></span><br><span class="line">  s = MY_MAFUC(   <span class="number">10</span><span class="string">"ab\n"</span>    );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(<span class="built_in">strcmp</span>(s, <span class="string">"10\"ab\\n\""</span>) == <span class="number">0</span>)</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Equal\n"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 逗号包括在圆括号中不作为实参分隔符</span></span><br><span class="line">  <span class="comment">// 都在在''或者""中也不作为实参分隔符</span></span><br><span class="line">  s = MY_MAFUC2((<span class="number">123</span>abc,<span class="number">45</span>;<span class="string">'0'</span>), [<span class="number">1</span>a2b3c:?<span class="string">','</span>=]);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"string is :%s\n"</span>, s);</span><br><span class="line">  <span class="comment">// 输出string is :(123abc,45;'0')</span></span><br><span class="line">  <span class="comment">//[1a2b3c:?','=]</span></span><br><span class="line">  <span class="comment">// 圆括号也会保留</span></span><br><span class="line"></span><br><span class="line">  s = MY_MAFUC2(,abcd);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"s = %s\n"</span>, s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="宏定义中的-操作符-1"><a href="#宏定义中的-操作符-1" class="headerlink" title="宏定义中的##操作符"></a>宏定义中的##操作符</h3><p>简单来说，##用于拼接。例如<code>#define CONCAT(x) x##10</code>，将10接到x的后面，<strong>并且替换后的不是字符串，而是原内容</strong>。例如<code>CONCAT(10)</code>，替换后的是1010，而不是字符串”1010”，这和#不同。结果1010可以赋值给整型变量，<code>int x = CONCAT(10)</code>。</p>
<p><code>##</code>后面可以接宏函数参数，也可以接常量</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CONCAT(x,y) x##10 + 0x##y</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> a = CONCAT(<span class="number">10</span>, <span class="number">16</span>);</span><br><span class="line"><span class="comment">// 将被替换成 int a = 1010 + 0x16</span></span><br></pre></td></tr></table></figure>
<h3 id="宏替换"><a href="#宏替换" class="headerlink" title="宏替换"></a>宏替换</h3><ul>
<li>同一文件作用域内，不能出现两个名称相同的宏标识符。但是同一个宏可以重复定义。</li>
<li>替换列表之前和之后的空白符，都不属于替换列表，会被忽略</li>
<li>一个宏定义中可以引用另外一个已定义的宏，宏定义可以连续扩展，但是不能递归，替换顺序如下：<ul>
<li>处理替换列表中的#和##</li>
<li>展开掉替换列表中的宏</li>
<li>检查实参是否引用了宏，替换实参宏</li>
<li>用扩展后的实参替换形参宏</li>
</ul>
</li>
<li>宏定义不能递归（包括直接递归和间接递归），递归的宏不会被替换</li>
<li>替换后出现在<code>#define</code>这样的预处理结构，编译器会报错</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 允许定义两个完全相同的宏</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MY_MACRO(x) x + x ## 0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MY_MACRO(x) x + x ## 0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LITERAL(x) #x</span></span><br><span class="line"><span class="comment">// 替换类标引用了宏LITERAL</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MY_MACRO2(x) LITERAL(x)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CONCAT(x,y) x ## y ## ELLO</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 替换为10 + 100，所a = 110</span></span><br><span class="line">  <span class="keyword">int</span> a = MY_MACRO(<span class="number">10</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"a = %d\n"</span>, a);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// #和##的优先级最高，所以MY_MACRO(20)，直接当作字符串返回了，不会继续扩展</span></span><br><span class="line">  <span class="comment">// s = MY_MACRO(20)</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *s = LITERAL(MY_MACRO(<span class="number">20</span>));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"s = %s\n"</span>, s);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 替换顺序是# -&gt; 替换列表的宏 -&gt; 实参宏 -&gt; 形参宏</span></span><br><span class="line">  <span class="comment">// 1. 替换MY_MACRO2，得到LITERAL(x)</span></span><br><span class="line">  <span class="comment">// 2. 替换LITERAL(x)，得到#x。这里的#x是扩展出来的（不是MY_MACRO2替换列表中的），所以不会将实参作为字符串，接下来扩展实参</span></span><br><span class="line">  <span class="comment">// 3. 替换MY_MACRO(20)，得到20 + 200</span></span><br><span class="line">  <span class="comment">// 4. 替换形参#x得到字符串"20 + 200"</span></span><br><span class="line">  s = MY_MACRO2(MY_MACRO(<span class="number">20</span>));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"s = %s\n"</span>, s);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 这里会得到#defineELLO，得到#开头的预处理指令，编译器会报错</span></span><br><span class="line">  <span class="comment">// CONCAT(#, define);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 这里先扩展MY_MACRO2，得到LITERAL(x)</span></span><br><span class="line">  <span class="comment">// 继续扩展，得到#x，#x不是MY_MACRO2替换列表中的，不会优先处理</span></span><br><span class="line">  <span class="comment">// 然后扩展实参CONCAT(if, def H)，得到ifdef HELLO</span></span><br><span class="line">  <span class="comment">// 替换形参#x得到"ifdef HELLO"</span></span><br><span class="line">  s = MY_MACRO2(CONCAT(<span class="keyword">if</span>, def H));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"s = %s\n"</span>, s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="可变参数的宏定义"><a href="#可变参数的宏定义" class="headerlink" title="可变参数的宏定义"></a>可变参数的宏定义</h3><p>从C99标准起，C语言开始加入了不定参数个数（可变参数）的宏定义。定义可变参数的宏函数时，宏的形参列表使用…来表示。再替换列表中，用<strong>VA_ARGS</strong>来表示…对应的参数内容。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> VARIDIC_MACRO1(...) <span class="meta-string">"the String is: "</span> #__VA_ARGS__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> VARIDIC_MACRO2(...) (__VA_ARGS__ ## 100)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> VARIDIC_MACRO3(a, ...) (a __VA_ARGS__ 10)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LITERAL(x) #x</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> VARIDIC_MACRO4(X) LITERAL(X)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *s = VARIDIC_MACRO1(<span class="string">"Good Luck!"</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"s = %s\n"</span>, s);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 这里的参数作为一个整体，而不是三个参数</span></span><br><span class="line">  s = VARIDIC_MACRO1(Say <span class="string">"Hi"</span>!, Byebye, Thank you);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"s = %s\n"</span>, s);</span><br><span class="line">  <span class="comment">// 输出：s = the String is: Say "Hi"!, Byebye, Thank you</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 替换成int a = (10, 20, 30100)，右边是一个逗号表达式，值为30100</span></span><br><span class="line">  <span class="comment">// 输出：a = 30100</span></span><br><span class="line">  <span class="keyword">int</span> a = VARIDIC_MACRO2(<span class="number">10</span>, <span class="number">20</span> ,<span class="number">30</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"a = %d\n"</span>, a);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> b = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 替换成 (++b - 20 + 10)</span></span><br><span class="line">  <span class="comment">// a = -9, b = 1</span></span><br><span class="line">  a = VARIDIC_MACRO3(++b, <span class="number">-20</span> + );</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"a = %d, b = %d\n"</span>, a, b);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 因为第一个参数被忽略，所以其为空，替换成( 30 * 10)</span></span><br><span class="line">  <span class="comment">// 注意30前面的空格被吃掉了，但是*后面的空格保留了</span></span><br><span class="line">  a = VARIDIC_MACRO3(, <span class="number">30</span> * );</span><br><span class="line">  s = VARIDIC_MACRO4(VARIDIC_MACRO3(, <span class="number">30</span> * ));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"s = %s\n"</span>, s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>要点：</p>
<ul>
<li>宏函数只有…，那么实参会当作一个整体传给宏函数</li>
<li>如果有参数，那么后面的参数会当做一个整体，包括’,’</li>
<li>__VA_ARGS表示的是形参中的…部分</li>
</ul>
<h2 id="C语言中预定义的宏"><a href="#C语言中预定义的宏" class="headerlink" title="C语言中预定义的宏"></a>C语言中预定义的宏</h2><p>C语言标准值出了C语言实现（即编译器）必须实现的预定义宏以及可选的预定义宏。</p>
<p>C语言中的预定义宏分为三类：</p>
<ul>
<li>C语言标准强制要求预定义的宏</li>
<li>环境宏，可选实现的预定义宏</li>
<li>条件特征宏，这也是可选的</li>
</ul>
<h3 id="C语言强制要求的预定义宏"><a href="#C语言强制要求的预定义宏" class="headerlink" title="C语言强制要求的预定义宏"></a>C语言强制要求的预定义宏</h3><ul>
<li><code>__DATE__</code>：表示当前日志，形式为Mmm dd yyy，Mmm是月份的缩写</li>
<li><code>__FILE__</code>：当前源文件</li>
<li><code>__STDC__</code>：如果值为1，说明当前C语言实现遵循C语言标准</li>
<li><code>__STDC_HOSTED__</code>：主机端实现值为1，独立式实现值为0.主机端实现值当前C源代码最终编译成当前平台目标兼容的二进制代码文件</li>
<li><code>__STDC_VERSION__</code>：当前C的版本，例如201710，C17版本</li>
<li><code>__TIME__</code>：当前实现，形式为hh: mm: ss</li>
<li><code>__func_</code>：当前函数名</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"The current date is: %s\n"</span>, __DATE__);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"The current time is: %s\n"</span>, __TIME__);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"The current file is: %s\n"</span>, __FILE__);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"The current function is: %s\n"</span>, __func__);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"The current line is: %d\n"</span>, __LINE__);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"The current stardard is: %ld\n"</span>, __STDC_VERSION__);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"The current date is: %d\n"</span>, __STDC_HOSTED__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="环境宏"><a href="#环境宏" class="headerlink" title="环境宏"></a>环境宏</h3><p>确定字符编码支持情况。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">"The current standard time is: %d\n"</span>, __STDC_ISO_10646__);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"The current support utf-16 is: %d\n"</span>, __STDC_UTF_16__);</span><br><span class="line"><span class="comment">// 支持UTF-32，值为1，上同</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"The current support utf-32 is: %d\n"</span>, __STDC_UTF_32__);</span><br></pre></td></tr></table></figure></p>
<p>_</p>
<h3 id="条件特征宏"><a href="#条件特征宏" class="headerlink" title="条件特征宏"></a>条件特征宏</h3><p>C标准中有一些语法特性是C语言编译器可选实现的，编译器根据这些宏来指明自己是否支持这些特性。</p>
<p>例如<strong>STDC_NO_THREADS</strong>用于指明当前C语言实现支持不支持<code>&lt;threads.h&gt;</code>头文件；<strong>STDC_NO_VLA</strong>指明当前C语言实现支不支持变长数组。</p>
<h2 id="主流编译器及平台预定义的宏"><a href="#主流编译器及平台预定义的宏" class="headerlink" title="主流编译器及平台预定义的宏"></a>主流编译器及平台预定义的宏</h2><p>以下预定义宏不是C标准指定的，而是编译器实现的。</p>
<ul>
<li><code>_MSC_VER</code>：如果定义了该宏，编译器是MSVC</li>
<li><code>__GNUC__</code>：GCC或者兼容GCC的编译器</li>
<li><code>__clang__</code></li>
<li><code>__i386__</code>：生成目标是32位x86处理器</li>
<li><code>__x86_64__</code>：x86_64处理器，运行再64位系统模式</li>
<li><code>__arm__</code></li>
<li><code>__arm64__</code></li>
<li><code>__APPLE__</code></li>
<li><code>__unix__</code></li>
<li><code>__linux__</code></li>
<li><code>_WIN32</code></li>
<li><code>_WIN64</code></li>
<li><code>__LP64__</code></li>
</ul>
<h2 id="条件预编译"><a href="#条件预编译" class="headerlink" title="条件预编译"></a>条件预编译</h2><p>条件预编译用于控制所要编译的代码。条件预编译中的条件为真时，这段代码参与编译，否则不参与编译。</p>
<blockquote>
<p>注意：这里的编译不仅仅指编译，也指预处理。如果条件为假，代码块中的预处理指令也不会执行</p>
</blockquote>
<p>控制条件包含的表达式应该是一个<strong>整数常量表达式</strong>。</p>
<p>此外还支持defined表达式，类似于sizeof，有两种形式<code>defined 标识符</code>和<code>defined(标识符)</code>。<strong>defined只能和条件控制语句联合起来使用，defined后面的标识符应该是一个宏名，如果该宏已经被定义，其值为1。还可以使用!defined</strong></p>
<h3 id="if和-elif预处理指示符"><a href="#if和-elif预处理指示符" class="headerlink" title="#if和#elif预处理指示符"></a>#if和#elif预处理指示符</h3><p>语法:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">if</span> 常量表达式 换行符</span></span><br><span class="line">  <span class="comment">// 代码块</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">elif</span> 常量表达式 换行符</span></span><br><span class="line">  <span class="comment">// 代码块</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"> <span class="comment">// 代码块</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure></p>
<p>如果常量表达式的值等于0，结果为false，否则为true。</p>
<p>常量表达式可以使用布尔表达式，可以使用==、!=、&amp;&amp;、||、!和算术运算。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  <span class="meta">#<span class="meta-keyword">if</span> 3 + 5</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"No zero expression"</span>);</span><br><span class="line">  <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(</span><br><span class="line">    #<span class="keyword">if</span> <span class="number">0</span></span><br><span class="line">      <span class="string">"0"</span></span><br><span class="line">    #elif <span class="number">3</span> - <span class="number">3</span></span><br><span class="line">      <span class="string">"1"</span></span><br><span class="line">    #<span class="keyword">else</span></span><br><span class="line">      <span class="string">"2"</span></span><br><span class="line">    #endif</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">define</span> HELLO</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">if</span> defined(HELLO)</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"HELLO defined"</span>);</span><br><span class="line">  <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">if</span> defined(HELLO) &amp;&amp; defined(HI)</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Both defined~!"</span>);</span><br><span class="line">  <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">define</span> HI 2</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">if</span> defined(HELLO) &amp;&amp; defined(HI) &amp;&amp; (defined(HELLO) + defined(HI)) == HI</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"HI value: %d\n"</span>, HI);</span><br><span class="line">  <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// aa 不是预处理阶段的标识符</span></span><br><span class="line">  <span class="keyword">int</span> aa = <span class="number">100</span>;</span><br><span class="line">  <span class="meta">#<span class="meta-keyword">if</span> aa == 100</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"aa is defined"</span>);</span><br><span class="line">  <span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"aa is not defined"</span>);</span><br><span class="line">  <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 预处理阶段定义了aa，并且aa的值是20</span></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">define</span> aa 20</span></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">if</span> aa == 20</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Yep!"</span>);</span><br><span class="line">  <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"aa = %d\n"</span>, aa);</span><br><span class="line">  <span class="keyword">enum</span> &#123;</span><br><span class="line">    M1,</span><br><span class="line">    M2,</span><br><span class="line">    M3</span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// M2不是预处理阶段的标识符</span></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">if</span> M2 == 1</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"M2 is defined!"</span>);</span><br><span class="line">  <span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"M2 is not defined"</span>);</span><br><span class="line">  <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 下面会报错，因为sizeof只能在编译阶段调用，sizeof不是合法的常量表达式</span></span><br><span class="line">  <span class="comment">// #if aa == sizeof(int)</span></span><br><span class="line">  <span class="comment">//   puts("Yep!");</span></span><br><span class="line">  <span class="comment">// #endif</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ifdef和-ifndef"><a href="#ifdef和-ifndef" class="headerlink" title="#ifdef和#ifndef"></a>#ifdef和#ifndef</h3><p><code>#ifdef</code>和<code>#if defined</code>类似，<code>#ifndef</code>和<code>#if !defined</code>类似（if not defined）。不同点是<code>#ifdef</code>和<code>#ifndef</code>后面只能跟预处理标识符，而不能跟常量表达式。</p>
<p><code>ifdef</code>和<code>ifndef</code>后面也要接<code>#endif</code>.</p>
<h2 id="include预处理指示符"><a href="#include预处理指示符" class="headerlink" title="#include预处理指示符"></a>#include预处理指示符</h2><p>通过头文件，可以将自己源码中的对外函数接口以及数据类型等共享给其他开发者。C语言的头文件以.h文件结尾，使用<code>#include</code>指令包含头文件。</p>
<p><code>#include</code>有两种形式：</p>
<ul>
<li><code>include &lt;头文件名&gt; 换行符</code></li>
<li><code>include &quot;头文件名&quot; 换行符</code></li>
</ul>
<p><code>&lt;&gt;</code>指定的文件路仅的搜索是实现自定义的，默认是操作系统存放库头文件的系统路径。也可以通过编译器环境变量和编译器命令行选项来指定。(例如在操作系统实现中，就不使用标准库，自定义了<code>&lt;&gt;</code>的查找位置)</p>
<p><code>&quot;&quot;</code>对指定的文件进行搜索，通常就是当前C语言工程项目下的路径；如果搜索不到，则换用<code>&lt;&gt;</code>进行搜索。</p>
<p>一般来说，对C语言标准库，我们使用<code>&lt;&gt;</code>，而对于自己编写的头文件，使用<code>&quot;&quot;</code>。</p>
<p><strong>#include后面可以跟一个宏名</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 头文件的内容</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> defs_h</span></span><br><span class="line"><span class="comment">// 用于防止重复include文件或者间接重复include</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> defs_h</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MY_MACRO 100</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> a;</span><br><span class="line">  <span class="keyword">float</span> f;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">MyFunction</span><span class="params">(struct S s)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"The value is %f\n"</span>, s.a+s.f);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// include文件中的内容</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"defs.h"</span></span></span><br><span class="line"><span class="comment">// defs.h中已经包含了&lt;stdio.h&gt;，不需要再次包含，重复包含会报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 重复包含defs.h没有问题，因为我们在defs.h中做了保护</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"defs.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"The macro value is %d\n"</span>, MY_MACRO);</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">S</span> <span class="title">s</span> = &#123;</span> <span class="number">10</span>, <span class="number">1.5f</span> &#125;;</span><br><span class="line">  MyFunction(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>#include</code>指令的作用就是将头文件中的所有内容包含到<code>#include</code>指令所在的文件中。在defs.h中使用了<code>#ifndef</code>，用于防止重复包含，上例中，我们第一次已经将头文件包含进来了，第二次就不会将内容包含进来了。<strong>这说明include不是简单的复制，会分析被include文件中的预处理指令，将预处理指令执行完的结果include进来</strong></p>
<h2 id="error"><a href="#error" class="headerlink" title="#error"></a>#error</h2><p><code>#error</code>指令用于在预处理工程中报出指定的错误诊断信息。其基本形式为：<code>#error 预处理符号 换行符</code><br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> MY_SAFE_MACRO</span></span><br><span class="line">  <span class="comment">// 报错，#error后面接的是错误信息</span></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">error</span> safe macro not defined!</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接报错，没有提示信息</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">error</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">warning</span> 警告信息</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="line"><a href="#line" class="headerlink" title="#line"></a>#line</h2><p><code>#line</code>用于作为行号控制，形式为：<code>#line 数字序列 换行符</code>后面的数字指示它下一行的行号，而忽略它之前的行号。</p>
<p>还有一种形式可以修改源文件名：<br><code>#line 数字序列 &quot;源文件名&quot; 换行符</code></p>
<p>注意，通过<code>__LINE__</code>宏可以获取到当前的行号，<code>__FILE__</code>可以获取到当前的文件名。</p>
<h2 id="undef"><a href="#undef" class="headerlink" title="#undef"></a>#undef</h2><p><code>#undef</code>用于取消之前定义的宏。</p>
<h2 id="pragma于操作符。"><a href="#pragma于操作符。" class="headerlink" title="pragma于操作符。"></a>pragma于操作符。</h2><p><code>#pragma</code>只是当前翻译单元使用某种编译特性进行编译。比如，可以指定哪些函数用某个优化选项进行优化，从哪里开始使用标准浮点约定等。形式为:<code>#pragma 预处理符号 换行符</code></p>
<p>这里的预处理符号就是编译选项，一般有编译器定义，但是C语言标准也定义了若干标准，以STDC作为前缀，形式为：<code>#pragma STDC 编译选项 开关值 换行符</code>。</p>
<p>开关值有三种，分别是：ON、OFF、DEFAULT。</p>
<p>C99引入了_Pragma操作符，语义和<code>#pragma</code>一样，不过可用于宏定义的替换列表中。形式：<code>_Pragma(字符串字面量)</code>。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> MY_SAFE_MACRO</span></span><br><span class="line">  <span class="comment">// 报错，#error后面接的是错误信息</span></span><br><span class="line">  <span class="meta">#<span class="meta-keyword">error</span> safe macro not defined!</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 直接报错，没有提示信息</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">error</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">warning</span> 警告信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用遵循浮点数标准的编译选项</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> STDC FP_CONTRACT ON</span></span><br><span class="line"><span class="comment">// 后面的代码启用O2进行优化</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> O2</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">MyFunc</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">  a += <span class="number">10</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"a = %d\n"</span>, a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> O0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可用于宏替换列表</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> DEBUG</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PRAGMA_OPTION _Pragma(<span class="meta-string">"O0"</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PRAGMA_OPTION _Pragma(<span class="meta-string">"o2"</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">PRAGMA_OPTION</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">MyFunc2</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a * a + b * b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">_Pragma(<span class="string">"O1"</span>) <span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="空指令"><a href="#空指令" class="headerlink" title="空指令"></a>空指令</h2><p><code>#</code>直接接换行就是空指令，空指定没有特殊作用。</p>

</article>
                </article>
          </main>
          <footer id="footer">
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Bright<br>
      powered_by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
<script src="/js/script.js"></script>
    </body>

</html>