<!DOCTYPE html>
<html>

  <head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
    <title>
      
        ucore-os笔记6：中断和异常、IDT和IDTR |
          
            Bright的个人博客
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/css/reset.css">
      <link rel="stylesheet" href="/css/style.css">
        <link rel="stylesheet" href="/css/github-markdown.css">
          <link rel="stylesheet" href="/css/atom-one-dark.css">
            
</head>

    <body>
      
        <header id="header" class="card">
  <span class="logo">B</span>
  <span class="motto">技术 & 梦想 |&nbsp;学习 & 总结</span>
  <nav>
    <ul>
    
      <li>
        <a href="/">首页 </a>
      </li>
    
      <li>
        <a href="/archives">归档 </a>
      </li>
    
      <li>
        <a href="/categories">分类 </a>
      </li>
    
      <li>
        <div class="search-input">
          <i class="fa search"></i>
          <input id="search-input" type="text">
        </div>
      </li>
    </ul>
  </nav>
</header>
          <main id="main">
            
              
<aside id="left-sidebar" class="margin-right">
  <nav class="card sidebar-component">
  <div class="card-title">文章归档</div>
  <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a><span class="archive-list-count">18</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a><span class="archive-list-count">30</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">18</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a><span class="archive-list-count">2</span></li></ul>
</nav>
  <nav class="card sidebar-component">
  <div class="card-title">文章分类</div>
  <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/css/">css</a><span class="category-list-count">10</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/css/css基础/">css基础</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/css/css工具/">css工具</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/css/less/">less</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/css/sass/">sass</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/docker/docker-swarm/">docker swarm</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/docker基础/">docker基础</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/html5/">html5</a><span class="category-list-count">8</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/html5/dom/">dom</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/html5/html5-API/">html5 API</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/html5/html5标签和属性/">html5标签和属性</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/html5/svg/">svg</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/html5/tips/">tips</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/html5/实战/">实战</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/spring实战/">spring实战</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a><span class="category-list-count">6</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/js/js基础/">js基础</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/typescript/">typescript</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/正则表达式/">正则表达式</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/linux/工具/">工具</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/nginx/">nginx</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/node-js/">node.js</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/node-js/npm/">npm</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/node-js/命令行工具/">命令行工具</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/php/">php</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/spring-boot/">spring-boot</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/spring-boot/开发工具/">开发工具</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/typescript/">typescript</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/typescript/踩坑指南/">踩坑指南</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/">vue</a><span class="category-list-count">11</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/vue/cli/">cli</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/tips/">tips</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/vue-router/">vue-router</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/vue实战/">vue实战</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/vue组件开发/">vue组件开发</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/基础/">基础</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/webpack/">webpack</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/webpack/webpack基础/">webpack基础</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/xml/">xml</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/xml/基础/">基础</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/学习打卡/">学习打卡</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全/">安全</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/安全/密码技术/">密码技术</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/操作系统/">操作系统</a><span class="category-list-count">23</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/操作系统/shell/">shell</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/操作系统/ucore/">ucore</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/操作系统/操作系统原理/">操作系统原理</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">10</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/mysql/">mysql</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/sql语句/">sql语句</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/导论/">导论</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/数据库编程/">数据库编程</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/数据库设计/">数据库设计</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构/">数据结构</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构/图/">图</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/毕设/">毕设</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a><span class="category-list-count">20</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/算法/leetcode/">leetcode</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/模式匹配/">模式匹配</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/深度优先搜索/">深度优先搜索</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程语言/">编程语言</a><span class="category-list-count">20</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/编程语言/C/">C</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/编程语言/C/语言/">语言</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程语言/C语言/">C语言</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程语言/Java/">Java</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程语言/java/">java</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/英语/">英语</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/英语/生词/">生词</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机网络/">计算机网络</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/计算机网络/wireshark/">wireshark</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机网络/问题记录/">问题记录</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a><span class="category-list-count">5</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/交给子类/">交给子类</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/生成实例/">生成实例</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/适应设计模式/">适应设计模式</a><span class="category-list-count">2</span></li></ul></li></ul>
</nav>
  <nav class="card sidebar-component">
  <div class="card-title">最近文章</div>
  <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/05/19/algorithm/leetcode/动态规划/interleaving-string/">interleaving string</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/17/algorithm/leetcode/分治/maximum-product-subarray/">maximum product subarray</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/15/algorithm/leetcode/动态规划/triangle/">triangle</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/12/algorithm/leetcode/动态规划/unique-binary-search-trees-ii/">unique binary search trees ii</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/11/algorithm/leetcode/动态规划/decode-ways/">decode-ways</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/09/algorithm/leetcode/动态规划/unique-path-II/">unique path II</a></li></ul>
</nav>
</aside>


                <!--
<aside id="right-sidebar">
  <nav class="card margin-bottom">
  
</nav>
</aside>

-->
                <article id="article" class="margin-right ofhidn">
                  <article class="post-article article markdown-body">
  <h1>
    ucore-os笔记6：中断和异常、IDT和IDTR
  </h1>
  <hr>
  <p>外部设备与CPU通信需要通过中断机制。例如，当按下键盘上的一个键的时候，必然要通知CPU该键被按下，一种方式是CPU一直监视键盘上有没有键按下，但是这种方式性能太低。另一种方式由设备主动通知CPU有事件发生，当键盘被按下时，键盘通知CPU有键被按下并且告知是哪一个键，这种方式就是中断方式。中断机制是系统具有响应式能力，也是进程/线程实现抢占式调度的一个重要基石（通过时钟中断）。</p>
<p>操作系统中有三种中断，分别是：</p>
<ul>
<li>外部设备引起的：IO中断、始终中断等异步产生的，与CPU的执行无关，简称为<code>中断</code></li>
<li>CPU运行中引起的：例如除0、缺页、地址越界等等，在CPU运行时CPU检测到的异常，称为<code>异常</code></li>
<li>用户调用引起的：例如系统调用，用户调用了INT指令，也是在CPU运行时检测到，称为<code>陷入</code></li>
</ul>
<p>上面的三种中断可以分为两大类，异步中断和同步中断。异步中断由外部事件产生，时间不确定。同步中断由CPU产生，可以是CPU执行时的异常，或者用户调用特定指定导致。</p>
<blockquote>
<p>中断还可以分为可屏蔽中断和不可屏蔽中断，可屏蔽中断由NMI引脚触发，不受EFLAGS寄存器中的IF影响。普通中断硬件由INTR引脚引起，可通过IF位屏蔽</p>
</blockquote>
<h2 id="中断处理过程"><a href="#中断处理过程" class="headerlink" title="中断处理过程"></a>中断处理过程</h2><p>当CPU检测到中断时，会中断当前指令的执行，调转到中断处理程序的位置执行。那如何直到中断处理程序在哪个位置呢？CPU使用IDTR和IDT和储存中断处理程序的地址。中断调用结束后会回到被中断的指令的位置继续执行，那如何直到中断前的指令的位置呢？通过堆栈来实现，CPU会自动将指令位置相关的寄存器cs、eip压入内核栈，中断结束后通过iret将栈中的数据恢复到寄存器中。</p>
<p>IDTR是中断描述符表寄存器，存了中断描述符（IDT）的起始地址和长度：<br><a href="/img/IDTR.png">IDTR</a></p>
<p>每一个中断有一个中断向量号，最多有256个中断向量号。中断向量号对应IDT中的表项，IDT是中断描述符表，里面最多有256个表项与中断向量号一一对应。寻找中断程序入口的步骤是，从IDTR找到起始地址，注意这里的起始地址就是线形地址，不需要在经过GDT转化；寻找计算对应的表项的地址，计算公式是base+interrupt number * 8，乘8是因为一个表项占8个字节。找到对应的表项之后，表项中存了中断程序的逻辑地址，就是段描述符+偏移；CPU将段描述符加载到段寄存器中，偏移加载到EIP中，然后就得到中断处理程序的线形地址，描述符表项结构：<br><a href="/img/IDT-entry.png">IDT表项</a></p>
<p>中断向量表的前32个是被CPU保留的，<code>[32,255]</code>是给用户使用的，所以ucore定义的中断都在32之后，包括IO设备中断、系统调用等等。cpu触发中断以后，会禁用中断（将EFLAGS寄存器中的IF位置0），中断处理程序中可以手动开启来实现中断嵌套，但是需要自行处理堆栈；陷入和异常不会禁用中断。</p>
<p>IDT中有三种描述符，在上图中有其格式，分别是：</p>
<ul>
<li>Task-gate descriptor</li>
<li>Interrupt-gate descriptor</li>
<li>Trap-gate descriptor</li>
</ul>
<h3 id="中断过程中硬件完成的工作"><a href="#中断过程中硬件完成的工作" class="headerlink" title="中断过程中硬件完成的工作"></a>中断过程中硬件完成的工作</h3><p>中断过程中的调转到中断程序和从中断程序都是硬件进行的：</p>
<ul>
<li>CPU在执行完每一条指令之后，都会检测中断请求，如果监测到中断请求，会从总线上读取对应的中断向量（对应计算机接口中的IO读周期）</li>
<li>用读取到的中断向量号来寻找中断向量的起始地址，通过IDT和IDTR找到描述符项</li>
<li>描述符项中有段描述符和偏移，利用它们找到GDT中的对应表项，取的中断服务程序的线形地址</li>
<li>CPU会根据CPL和中断处理程序的段描述符的DPL确定是否发生了特权级的转换。因为用户程序运行在用户态，而内核程序运行在内核态。中断会陷入内核态，如果是在用户态，则需要先切换到内核态。在用户态执行int指令，会通过TSS和TR可以取得内核栈地址，切换到内核栈然后将用户态的ss和esp压栈保存下来。如果是内核态陷入中断，则不需要这些处理，栈中也没有ss和esp</li>
<li>CPU会保存一些现场信息用于返回原程序执行，所以会压栈eflags、cs、eip、errorCode（有的中断有errorCode，有的中断没有，是CPU预置的）</li>
<li>CPU将cs、和eip切换到中断程序的地址，然后开始执行</li>
<li>执行完中断程序以后，通过iret指定恢复原有的程序。指定iret后，CPU会将eflags、cs、eip从栈中恢复到寄存器中，cpu不会自动弹出errorCode，需要手动弹出</li>
<li>如果是有特权级切换，不管是用户态还是内核态，都会弹出ss和esp。</li>
</ul>
<p>中断处理程序寻址过程：<br><a href="/img/idt表项寻址过程.png">中断处理程序寻址过程</a></p>
<p>堆栈变化：<br><a href="/img/堆栈变化.png">堆栈变化</a></p>
<p>这里需要注意堆栈变化，当有权限切换时，会压入/弹出SS和ESP，不管是从内核到用户态还是从用户态到内核态。例如，从内核触发中断的时候，没有发生切换，所以不会压栈SS和ESP，但是如果在中断程序中切换了CS到用户态的CS，那么从中断返回的时候，就会从堆栈中多弹出SS和ESP，写代码的时候要注意这一点（lab1挑战实验1）。<br><a href="/img/interrupt-stack.gif">堆栈变化1</a></p>
<h3 id="中断处理过程中的特权级转换"><a href="#中断处理过程中的特权级转换" class="headerlink" title="中断处理过程中的特权级转换"></a>中断处理过程中的特权级转换</h3><p>中断时CPU会进行特权级的检查。这个特权级的检查分成两个部分，一个是IDT中表项中的段描述符，段描述符中的DPL确定了所处段的特权级，<strong>只有段描述符的特权级高于或等于当前特权级时，检查通过</strong>；当触发中断和从中断程序返回都会检查，检查中断程序的段选择符和当前的CS，如果两者的DPL不相同，就发生特权级切换了，堆栈处理操作不同，看上一小节的堆栈图。</p>
<p>另一个是IDT表项中的DPL，如果是用户态程序触发的（例如INT n），还会检查表项中的DPL，只有当DPL更低时或相同时才通过检查，这就阻止了用户程序能够触发任意的中断，例如用户态为3，那么就只能触发DPL为3的中断。<strong>这里需要注意只有INT指令触发的中断，才会检查DPL，由硬件触发的中断不会检查DPL，所以硬件中断的代码即使位于内核段中，也能直接被调用；但是权限切换依然会被检查，如果当前是用户态执行触发了硬件中断，那么会压入ss和esp</strong></p>
<p>如果检查失败，CPU会触发一个保护异常。<br><a href="/img/idt-privilige-check.png">idt-privilige-check</a></p>
<h3 id="ucore-os对于中断的实现"><a href="#ucore-os对于中断的实现" class="headerlink" title="ucore-os对于中断的实现"></a>ucore-os对于中断的实现</h3><p>ucore-os的中断向量表定义在kern/trap/vector.S中，该文件由tools/vertor.c文件生成。vector.S文件的主要内容是定义了256个中断向量处理程序的入口，在中断时的有的会自动压入errorNumber，有的不会，vector.S中的不会自动压入errorNumber的会压入一个0，以统一结构。每一个程序再压栈errorNumber（如果CPU不会自动压栈的话）和压栈中断向量号后，同一调转到<code>__alltraps</code>执行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.globl __alltraps</span><br><span class="line">.globl vector0</span><br><span class="line">vector0:</span><br><span class="line">  pushl $0</span><br><span class="line">  pushl $0</span><br><span class="line">  jmp __alltraps</span><br></pre></td></tr></table></figure></p>
<p><strong>alltraps是另一个汇编文件trapentry.S中定义的全局符号，链接后会指向trapentry.S中的`</strong>alltraps`。trapentry.S的作用是构造trapframe的栈结构，并调用trap函数，trap函数返回后出栈trapframe的结构。因为涉及到特定寄存器的入栈出栈，这一部分代码用汇编语言描述最方便。</p>
<p>vector.S中定义了全局段全局符号<code>__vectors</code>，其值是一个数组的起始地址，数组的每一项是每一个入口程序的地址。因为符号<code>__vectors</code>是全局符号，所以可以在C程序中可以直接访问，因为链接后会加入到符号表中。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># vector table</span><br><span class="line">.data</span><br><span class="line">.globl __vectors</span><br><span class="line">__vectors:</span><br><span class="line">  .long vector0</span><br><span class="line">  .long vector1</span><br><span class="line">  .long vector2</span><br><span class="line">  .long vector3</span><br><span class="line">  .long vector4</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure></p>
<p>再idt_init进行idt初始化的时候，要做的事情就是构造IDT表并填充表项。<code>__vectors</code>中已经有了中断处理函数的地址，只需要在设置DPL等等其他表项的内容，就能构造出来IDT表。最后将IDT表的地址使用lidt指令加载到IDTR寄存器中，我们就完成了中断向量表的初始化。</p>

</article>
                </article>
          </main>
          <footer id="footer">
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Bright<br>
      powered_by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
<script src="/js/script.js"></script>
    </body>

</html>