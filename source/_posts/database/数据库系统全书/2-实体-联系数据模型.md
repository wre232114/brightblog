---
title: 2.实体-联系数据模型
date: 2020-02-06 08:47:48
tags:
- 数据库
- 数据库设计

category:
- 数据库
- 数据库设计
---
## 复习要点大全
本篇复习笔记的要点，分成大概下面几个部分：
* 1.E/R图的基础知识：E/R的组成、表示及其细节等
  * 数据库建模的步骤：构思->E/R模型->关系模型->关系DBMS
  * E/R模型的三个要素：实体集、属性（带下划线的属性是键）、联系
  * E/R图的图形表示：矩形表示实体集、椭圆表示属性、菱形表示联系
  * 联系的多样性：两个实体集中的联系可能存在`一对一`，`多对一`，`多对多`。重点是这三种关系的理解。
  * 多路联系：多个实体共享相同的联系，例如多方签合同
  * 联系中的角色：一个联系中，一个实体集可以出现多次，每次表示不同的角色。通过命名联系来区分角色。
  * 联系的属性：有时候需要给联系添加属性，例如合同有签订薪水，这份薪水与合同（联系）相关，而于任何实体集不相关。
  * 多路联系化二元联系：将多路联系化成实体集，原来的联系与实体集的连线变成新的二元联系。
  * E/R模型中的子类：子类有父类公共的属性以及自生额外的属性。子类与父实体集通过`isa`的联系相连，`isa`用顶角向上的三角形表示。`isa`联系不标箭头，但是都是1对1联系。E/R图中子类上只连接自己特有的属性。子类拥有父类的属性和联系。
* 2.设计原则
  * 忠实性：设计要忠于现实世界，以及实际情况。
  * 避免冗余：相同的数据避免存储两次。冗余可能导致：1.浪费空间。2.修改时没有全部修改导致不一致。
  * 简单性考虑：设计尽可能简单，除非绝对需要，否则一定不要添加额外的成份。
  * 选择正确的联系：实体集可以以多种方式联系起来。联系是否需要首先取决于实际情况，其次取决于联系是否是冗余的——即该联系可以由其他联系导出。
  * 选择正确的元素种类：属性是最容易实现，当然是使用实体集还是使用属性来进行建模，是根据实际情况确定的。
* 约束的建模
  * E/R图中的元素只能表示结构上的约束，不能表示数据上的约束。数据上的约束需要额外的建模。
  * 约束一般有：
    * 键约束：唯一标识一个实体的属性或者属性集。E/R图中通过带下划线的属性表示键。父实体集必须拥有所有的键属性。
    * 单值约束：属性值在某种情况下具有唯一性要求。键约束也是单值约束；还有多对一联系等
    * 引用完整性约束：被引用的某个值在数据库中必须存在。E/R图中通过连线的圆角表示引用完整性约束。
    * 域约束：属性只必须在一个值集或者范围内。
    * 一般约束：任意定义的任意的约束。例如要求影星不超过10个。
* 弱实体集
  * 一个实体集的键是由**另一个实体集的部分或者全部属性构成**，这样的实体集称为弱实体集。
  * 弱实体集主要由两个来源：1.一个实体集E和另一个实体集F处于层次结构中，但是不是子类的关系，E的键要通过F才能唯一确定。例如球员编号，只有知道是哪个球队的多少号才能确定一个球员。2.连接实体集，例如多路联系中转为二元联系时新建的实体集，这种实体集没有自己的键，其键由多个实体集来确定。
  * 弱实体集的要求：1.只能通过多对一联系来获取其他实体集的**键属性**作为键。2.该多对一联系必须有引用完整性。3.多个多对一联系，每个联系都会提供键
  * 弱实体集的符号：1.弱实体集用双边矩形来表示。2.弱实体集的多对一支持联系用双边菱形表示。

上面的是要点总结，忘记细节看本文后面的详细知识点细节。

## 概述
实体-联系模型也叫E/R模型，是数据库设计方向的研究范畴。数据库设计最要的是设计出要存储的信息以及信息组成部分之间的关系。通常数据库的结构称为**数据库模式**，一般以某种语言或者符号来描述。除了E/R模型以外，还有关系模型、对象模型、半结构化模型等。

在实际的数据库建模中，E/R模型并不直接作为数据库管理系统的直接模式，原因是E/R模型是一种抽象模型，并不是足够有效的数据结构。最常见的DBMS采用的模型是关系模型。所以实际数据库建模的步骤一般如下：
```
思想  ---> E/R设计 ---> 关系模式 ---> 关系DBMS
```
一般的数据库设计步骤是：先明确要存储的数据，利用E/R模型设计出数据实体属性以及数据实体之间的联系；然后通过一定的规则将E/R模型转为关系模型；最后将关系模型转成DBMS支持的输入，例如sql语句，输入DBMS建立真实的数据模型。

## E/R模型的要素
E/R模型一共有三个要素：
1. 实体集
2. 属性
3. 联系

实体集是某一个抽象事务的集合，从面向对象的角度来说，“实体”和“对象”很相似。“实体集”和“对象类”也有相似性，但是“实体集”只包含属性，而不包含对属性的操作。以电影举例，每部电影是一个实体，所有电影构成实体集，电影都有主演、制片人、导演等等属性。

实体集具有`属性`，属性是实体集中的实体所有的性质。例如电影实体中可能有title、length这些属性来表明电影的标题和时长。

联系是两个或者多个实体集之间的连接。例如Movie和Stars是两个实体集，那么Star出演Movie，那么两个实体集之间就具有了某种联系Star-in。例子中的联系是二元的，E/R模型支持多路联系。在转为关系模型时，多路联系会转成二元联系，后面的笔记会详细讲述这一部分。

### 实体-联系图
上面讨论了E/R模型的三个要素，可以以图形的形式来描述实体集、属性和联系。每一种元素都用不同的图形来表示，使用实线来连接属性、联系和实体集。三个要素分别用下面的图形来表示：
* 矩形表示实体集
* 椭圆表示属性
* 菱形表示联系

如下例：
！[E/R模型图例](/img/E-R模型示例.png)

上图中的有三个实体集：movies、stars、studios，这些实体集用矩形表示。每一个实体集都有自己的属性，属性用椭圆表示。三个实体集之间有两个联系，联系用菱形表示。实体集、属性、联系之间均以实线相连。

E/R模型并不会直接存入数据库，但是在进行数据库设计之前，先想一下E/R模型，确定数据对象的属性和其联系，能够帮助我们更好的进行数据库设计。

联系一般表示两个实体之间某些属性之间的对应关系，例如star和movie具有star-in的联系R，表示某一个明星出演某一步电影，R的可以元组可能是`Alice Starwar`，表示Alice出演了Starwar这部电影。通过在联系中将star的name属性和movies的title属性关联，就能确定不同实体集之间的实体的关系。

### 联系的多样性
上面举的联系的例子中，两个实体集之间的实体的关系可能是一对一的关系，即仅一个明星出演仅一部电影，但是可能存在一个演员至多出演一步电影且一部电影可以请多个演员，这种关系就是多对一。也可能存在一个明星参演多部电影，一部电影多个明星演，这种关系就是多对多。所以我们说联系具有**多样性**，联系可能是一对一、多对一、多对多。向下详细说明这三种联系的定义：
* 多对一：如果实体集E中任一实体通过联系R**至多**与实体集F中的一个实体联系，那么R称为E到F的多对一联系
* 一对一：如果E到F是多对一联系，F到E也是多对一联系，那么R称为E到F的一对一联系
* 多对多：即不是多对一也不是一对一

> 为了便于理解，可以从函数的角度来理解，E看作定义域，F看作值域。定义域中取一个值，如果值域值多有一个值相对应，那么是函数。所以多对一和函数的定义其实是相同的。取一个x，最多一个y。如果反过来也成立，取一个y最多一个x，那么x和y就是一一对应的了，即一对一的关系。

E/R图中使用箭头来表示联系的多样性，简单来记就是：**箭头指向一**，即如果R是E到F的多对一联系，那么R到F的联系要打箭头。用上例的图，如果stars到movies是多对一联系，那么图如下：
![E/R图例1](/img/E-R模型示例1.png)

给定一个演员，最多一部电影，但是多个演员可以出演相同的电影。

### 多路联系
上面给出的联系都是二元联系，但是联系可以是多路的。举个例子，假如有三方签合同，三方分别是三个实体集，那么这三个实体集肯定都共享“合同”这个联系，如下例：
![多路联系](/img/多路联系.png)
上例中的箭头也表示多对一的关系，表示一个明星最多签约一家制片公司，一部电影也最多签约一家制片公司。

### 联系中的角色
同样，一个实体集在一个E/R图中可能多次出现，例如电影和其续集的关系。电影和电影的续集都属于电影这个实体集，那么在电影到电影续集这个联系中，同一个实体集（电影）充当了两个**角色**。人们一般给联系的联系来命名来区分角色，如下例：
![联系中的角色](/img/联系中的角色.png)

### 联系的属性
