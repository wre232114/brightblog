---
title: 4.关系代数
date: 2020-02-11 09:48:16
tags:
- 数据库
- 数据库编程

category:
- 数据库
- 数据库编程
---
前面复习的是数据库设计，包括如何建模（E/R模型），如何转化为实际的数据库模型（关系模型）以及设计消除冗余等异常的关系（BCNF，四范式、散范式）。这里开始复习数据库编程的设计，即用户如何查询和修改数据库的内容，从关系代数开始。

`关系代数`能够描述关系上的操作，包括并、差、笛卡儿集、选择、投影、连接等。关系代数能够描述如何从给定的关系中查询和修改特定的元组，sql等高级语言就以关系代数作为工具来对关系数据库进行查询和修改。

## 复习要点
* 一般系统将关系看成`包`而不是`集合`，`包`允许重复的元组（没有键约束的情况下）
### 基于集合的关系代数
* 关系代数基础：代数一定有操作符和原子操作数，关系代数的操作数是关系，操作符是关系操作。
  * `关系代数`的原子操作数是：1.代表关系的变量。2.代表有限关系的常量。
  * 操作符是：1.并、交、差。2.除去某些行或者列的操作；`选择`是除去行，`投影`是除去列。3.组合两个关系元组的操作；有笛卡儿运算（两个关系所有可能的元组配对方式）、连接（两个关系选择一些元组配对）。4.重命名，改变属性的名称或者关系的名称
  * **关系代数的表达式称为查询**。
  * **关系代数的所有操作得到的结果集合都会去重。**
* 1.关系的集合操作：并（union）、交（intersection）、差（difference）。**所有集合操作会将结果去重！！**
  * 并（$R \cup U$）：得到R中、U中以及R和U中都有的元组组成的关系。
  * 交（$R \cap U$）：得到R和U中都有的元组组成的关系。
  * 差（$R-U$）：得到在R中但是不在U中的元组组成的关系。
  * 上述运算需要添加条件才能进行：1.R和S必须是具有同样属性的关系。2.R和S的列必须是一一对应的。如果要对属性个数相同、但是名称不同的关系进行集合操作，需要使用重命名操作。
* 2.投影（projection）：投影用来生成新的关系，这个关系只包含原来关系R的部分列。$\pi_{A_1,A_2,...,A_n}(R)$表示R在$\{A_1,A_2,...,A_n\}$上的投影，即投影得到的关系由$\{A_1,A_2,...,A_n\}$这些属性组成。
* 3.选择（selection）：通过选择的条件筛选元组得到新关系。$\sigma_{c}(R)$表示R中满足条件c的元组组成的关系。c是条件表达式，可以使用$=\gt\le$等比较符以及AND、OR等连接符。
* 4.笛卡尔集：表示为$R\times S$，表示R和S中所有元素的组合，如果R中有两个元组，S中有三个元组，那么$R\times S$有6个元组。
* 5.连接：笛卡儿集是两个关系中元组任意组合，而连接是只将满足条件的特定元组组合。连接分为：
  * **自然连接**：如果两个关系有相同的属性，那么在两个关系中满足相同属性的值相同的元组会被连接。例如R(A,B)和S(B,C)，关系R和S有相同属性B，那么自然连接将R和S中B相同的元组连接起来。得到的关系是$R\Join S=T(A,B,C)$，B只会出现一次。**注意R和S中每两个元组都需要尝试进行配对。**
  * **$\theta$连接**：将满足给定条件的元组进行连接，记作$R\underset{C}{\Join} S$，相当于：1.求$R\times S$。再选择满足条件C的元组。R和S中的相同元素会出现两次，例如T(A,R.B,S.B,C)。
* 6.组合上述操作：通过组合上述操作，可以得到任意复杂的表达式。例如$\pi_{title,year}(\sigma_{length\ge 100}(movie))\cap (\sigma_{starName='Fox'}(movie))$，表示取movie中的length大于等于100的且starName='Fox'的元组，然后将这些元组投影到title和year上。
* 7.重命名：$\rho_s(A_1,\ldots,A_n$)(R)，表示将关系R重命名成S，且属性名对应改成$A_1,\ldots,A_n$。重命名不会修改关系中的属性个数和元组数据，只会改名。如果不改属性名，属性名可以不写，变成$\rho_s(R)$。
* 8.基本操作集：有一些操作能够从由若干其他操作代替，不能由其他操作代替的操作的集合称为基本操作集，有`连接、差、投影、积运算和重命名`

### 包上的关系操作
* **包上的关系操作**：包和集合的区别是，`包允许重复的元组`。常见的DBMS中基本是基于包实现的，因为包上的关系操作有更高的效率，不需要去重。而且投影时，如果得到的是相同的若干元组，例如(1,2,3)，(1,2,4)投影前两个会得到(1,2)和(1,2)，如果采取集合对结结果去重，那么聚集操作会丢失数据。
* 包的并、交、差：
  * 1.并：包的并要将相同元组出现的次数相加，如果两个包中一个包含元组r次，另一个包含同样的元组m次。求并后得到的包含元组r+m次。
  * 2.交：包的交取相同元组出现次数的最小值。$\min(r,m)$
  * 3.差：包的差取相同元组出现次数的差。$\max(0,r-m)$
* 包的投影操作：投影直接得到原关系的每一个元组，不过元组只包含投影的属性。不去重。
* 包的选择：和集合上的选择相同，不去重。
* 包的笛卡儿集：和集合上的笛卡尔集相同，不考虑重复元组的问题。例如两个包中分别有r和m个重复元组，那么笛卡尔集结果中有r*m个元组。
* 包的连接：和集合上的连接相同，区别是不去重。

### 关系代数的扩展
* 前面的是经典的关系代数，现代查询语言包含更多的关系代数操作，这些操作称为关系代数的扩展
* 1.取重操作符$\delta$：去除重复元组
* 2.聚集操作：例如求和、求平均值等。被`分组操作`使用，对**某一组**中所有元组进行聚集。有SUM、AVG、MIN、MAX、COUNT等。
* 3.分组操作$\gamma$：根据一个或者多个元素的值进行分组，这些元组称为分组元素，分组元素的值相同多元组被分成一组。
* 4.排序操作$\tau$：根据一个或者多个属性排序，只改变元组的顺序
* 5.扩展投影：可以以原来的列进行计算，得到新的列。
* 6.外连接：自然连接会出现悬挂元组，即一些没有配对成功的元组。外连接分成**左外连接和右外连接**，会填充左边或者右边关系的悬挂元组的空属性为null。

### 关系的约束
* 引用完整性约束：规定某个上下文中出现的值也必须在另一个上下文中出现。例如关系中一个关系R的某个属性A引用另一个关系S中的某个属性B，当R中取某一个元组具有属性值a时，a值也必须在S中某个元组中存在。如SQL中的外键约束。
* 其他约束：例如域约束等等。