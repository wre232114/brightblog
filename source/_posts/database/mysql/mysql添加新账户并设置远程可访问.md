---
title: mysql添加新账户并设置远程可访问
date: 2020-02-25 15:57:14
tags:
- 数据库
- mysql

category:
- 数据库
- mysql
---
这篇文章学习mysql中的用户创建和权限管理，最终的成果是创建一个新的只拥有某一个数据库访问权限的账户，同时开启这个账户的远程访问权限。参考资料是《mysql技术内幕》的第十三章。

## MySQL账户管理
参考另一篇博客，[mysql安全性和访问控制](#)

## 示例：添加新用户、授权并开启远程访问
1. 创建新用户
```sql
create user 'valner'@'%' identified by '密码';
```

2. 为新用户赋予指定数据库的访问权限
```sql
grant ALL on valner.* to 'valner'@'%';
```
mysql的账户名有用户名（登陆用的）和主机地址以及字符`@`组成，格式是`'username'@'hostname'`。同一个username，但是hostname不一样视为不同的用户，这也是为什么`'root'@'localhost'`（默认账户）远程登陆不上，因为root只允许在localhost登陆，如果需要开启远程登陆，可以指定'%'表示在所有机器上都可以登陆，也可以指定具体的域名或者ip地址或者通配符。

### 踩坑记录
正常来说按照上面的设置应该是可以正常远程访问的。但是，首先操作系统会有防火墙，mysql使用的3306端口不一定会对外开放；所以一定要在防火墙开放3306端口。在centos7下可以使用`firewall`、`iptables`。

其次，我们一般使用的是云服务器，云服务器提供商出于安全的考虑，可能限制服务器开放的端口，需要我们在运营商的后台手动配置开放的端口。我这里买的是阿里云的服务器，阿里云的云服务器就会限制对外网开放的端口，需要手动在阿里云网站的管理后台来手动添加开发的端口。（查了半天这个原因，明明firewall和iptables服务都没有启动，但是3306端口就是不开放。）

还可以通过`nmap`工具来扫描服务器开放的端口。