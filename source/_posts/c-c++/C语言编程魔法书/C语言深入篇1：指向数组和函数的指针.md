---
title: C语言深入篇1：指向数组和函数的指针
date: 2019-11-20 22:37:38
tags:
- 编程语言
- C语言
- 《C语言编程魔法书》

category:
- 编程语言
- C语言
---
前面我们学习过指针、数组、函数的概念，也了解了指向数组和函数的指针。这里深入理解和学习指向数组和函数的指针。

首先我们从类型的概念入手，每一种指针都有自己的类型，要了解指向数组和函数的指针，首先需要理解这两种指针指向的数据类型。

然后了解这两种类型的变量的声明方式以及理解。

然后学习这两种类型复合类型，例如：指向数组的指针的数组怎么表示？指向函数的指针的数组怎么表示？如果作为函数的参数类型和返回类型？

## 如何理解指针的类型
C语言中的指针的值是一个地址，在64位系统中，始终是8个字节，那么`int *`和`double *`有什么区别呢？前面的学习文章也提到过，区别在于，如何解释指针的值，也就是指向的地址，中的内容。

如果是`int *`，则将指针指向的地址作为起始地址，到其后4个字节的内容解释为1个int型的整数。

指向数组和函数的指针也是指针，自然也有上面的结论，所以我们知道：
1. 指向数组的指针的值，是一个数组的地址
2. 指向函数的指针的值，是一个函数的地址

学习数组的时候，我们知道`int *`可以指向一个数组，那和指向数组的指针有什么区别呢？

`int *p = &a`表示的是指向数组的起始地址，并将起始地址之后的4字节字节作为int解释。**所以一种解释是，`int*`指向的是数组的元素，通过移动`int*`指针可以访问数组元素**

`int(*pa)[n] = &a`表示的是指向数组的起始地址，并将起始地址之后的4*n个字节作为**数组**解释。**所以指针pa指向的是数组**，`*pa`取到是数组，我们要取数组元素怎么办？`(*pa)[i]`，`(*pa)`是数组，加括号是因为运算符优先级的原因。因为`*pa`和`p[0]`是等同的，我们也可以写成`pa[0][i]`

如果指向数组的指针指向了二维数组呢？例如：
```c
int aa[2][3] = { 1, 2, 3, 4, 5, 6 };
int (*pa)[3] = &a;
```
和上面一样理解，pa指向二维数组a的地址；这里我们首先要了解一个概念，二维数组元素也是连续存放的，假设是`[1,2,3,4,5,6]`，那么`(*pa)`或`pa[0]`取到的就是一个数组，其值是`[1,2,3]`，`*(pa+1)`或者`pa[1]`值是`[4,5,6]`

由此我们也能知道`int **p`的含义，指针的值还是一个指针。

## 两种指针的类型和变量声明方式
### 指向数组的指针
指向数组的指针的类型是：`类型 (*)[n]`，这是指向一维数组的。指向二维数组的呢？`类型 (*)[n][m]`。依次类推。
> 这里要注意类型很重要，在这两种指针类型作为函数返回类型以及作为形参类型的时候，需要正确书写类型，后面会详细说明

如何声明指针变量呢？`类型 (*标识符)[n][m]...`，例如：
```c
// 声明了一个类型为int(*)[3]的指针
int (*p)[3];
// 声明了一个类型为int(*)[3][3]的指针
int (*pa)[3][3];
```

如何声明指向数组的指针的数组呢？
```c
// 声明含两个元素的数组，数组成员是int(*)[3]
int (*pa[2])[3];
```
### 指向函数的指针
类型：`类型 (*)(形参列表)`。

声明：`类型 (*标识符)(形参列表)`，`类型 (*标识符[n])(形参列表)`。

示例：
```c
// 声明了指向 一个返回类型为int，只有一个int参数的函数 指针
int (*func)(int);

// 两个元素的数组，成员是函数指针
int (*func[2])(int);
```

## 作为函数的参数和返回值
### 指向数组的指针
1. 作为函数返回值类型


    形式：`类型 (* 标识符(型数列表))[n]`，例如`int (*f(int))[2]`，示例中的`int (* xxx)[2]`表示返回类型为`int(*)[2]`，`f(int)`表示函数名和形参列表的声明。
    ```c
    int (*func1(int n))[3] {
      return &(int[]){ 1,2,3 };
    }
    ```
2. 作为函数参数类型

    形式：`int main(int(*p)[10]);`

    ```c
    // 参数为int(*)[10]类型的函数声明
    int func2(int(*)[10]);

    int func2(int(*p)[10]) {
      return sizeof(p);
    }
    ```
    两者结合起来：
    ```c
    int (* func3(int(*pp)[10]))[10] {
     return pp;
    }   
### 指向函数的指针
指向函数的指针和指向数组的指针是类似的。将指针类型换一下就行了，我们直接上代码：
```c
// 函数指针作为返回类型
// int(* xxx)(int)，表示返回类型为int(*)(int)，xxx是：函数名(形参列表)
int (* func4(int))(int);

// 函数指针作为形参
int func5(int(*p)(int a)) {
  p(10);
  return (*p)(20);
}

// 两者结合
// 返回类型是int(*)(int)
// 参数有两个，一个是int(*)(float)，一个是int(*)[10]
int (* func6(int(* f1)(float), int(*pa)[10]))(int) {

}
```