---
title: 3.C语言的基本运算操作符
date: 2019-11-13 16:37:49
tags:
- 编程语言
- C语言
- 《C语言编程魔法书》

category:
- 编程语言
- C语言
---
## 算术运算
+、-、*、/、%以及+=、-=等

## 按位运算
&、|、^、~以及&=、|=等。分别表示按位与、按位或、按位异或和按位取反

## 自增自减
++、--

## 逻辑运算
&&、||、!。&&和||都是短路运算符。

还有>、<、<=、>=、==、!=等比较运算符。

## 移位运算符
<<、>>、以及<<=、>>=。C语言中如果右操作数是负数或者大于左操作数位宽，那么结果是未定义的。不同的平台可能有不同的行为。算术移位还是逻辑移位在C中根据源操作数是否是带符号数来决定。（在其他语言中可能使用<<<、>>>来表示不带符号移位）。如果是带符号移位，高位填充的是符号位。低位始终填充0.

## 圆括号操作符
用于提升表达式的优先级。圆括号表达式是基本表达式，和字面量常量一样，属于优先级最高的那一层。**圆括号表达式可以是左值** 

## sizeof运算符
sizeof属于单目操作符，语法：
* sizeof 表达式
* sizeof(类型名，例如int)

`sizeof 表达式`表示表达式的**值的宽度**。`sizeof(类型名)`表示类型的宽度。

sizeof返回其操作数的大小（占用多少字节），用一个整数值来表示，C语言实现都是用size_t。**sizeof表达式的值不一定是在编译时就能够确定的常量，因为表达式的值可能不是编译时就能确定的，例如从键盘输入的值。预编译时期的sizeof更不是常量，必须到编译时或者运行时才能确定sizeof的值！！！！！**

* 对于数组，返回的是数组所占的字节数；
* 对于指针、返回的是指针的宽度（64位系统中是8个字节）；
* 对于基本类型，返回的是基本类型的宽度（例如int是4个字节）；
* 对于struct，返回的是struct所占的总大小。注意这里的字节大小是经过字节对齐的。看下面的示例
* 操作数不能是位域。

```c
#include <stdio.h>

int main() {
  char *str = "123中文";
  int a[10];
  long t = 10;
  long* b = &t;
  int* pa = a;

  struct Name
  {
    char firstName[20];
    char* lastName;
  } s;
  

  printf("%zd %zd %zd %zd\n", sizeof(str), sizeof(a), sizeof(b), sizeof(pa));

  printf("%zd %zd %zd %zd\n", sizeof(struct Name), sizeof(s.firstName), sizeof(s.aaa), sizeof(s.bbb));
// 8 40 8 8
// 32 20 2 8
  return 0;
}
```

在上面的示例中，我们发现sizeof(struct Name)是32而不是28，这是为什么呢？上例中char数组按照1字节对齐，char*按照8字节对齐。firstName占了20个字节，而lastName占8字节对齐。8字节对齐的意思是起始地址必须是8的倍数，所以lastName必须从24开始，占8个字节，一直到32。中间的四个字节填充0。所以struct Name的大小是32字节。关于字节对齐请看后文[5.C语言的字节对齐](/2019/11/18/5.C语言中的字节对齐和字节填充.html)

> 注意：对成员取sizeof，取到的是对齐前的宽度。

如果我们改成:
```c
struct Person {
  int8_t a;
  int16_t b;
  int8_t arr[20];
}
```
那么总共占多少个字节呢？最大成员对齐宽度是int16_t的2字节。所以对齐宽度是2字节。总字节数是1+2+20 = 23，向上对齐到24字节，填充一个字节凑成24，所以占24个字节；如果在添加一个int8_t d呢？刚好凑齐24字节，不需要填充，总数还是24字节。

如果把int16去掉，只剩下int8数组和int8变量呢？这时候发现占21个字节，没有对齐？因为成员的最大对齐宽度是1字节，

> 字节对齐和计算机结构相关，总线一般是32位的，按照总线能够传输的位数对齐能够加快传输速率，否则需要重新寻值在访存然后拼接结果。字节对齐出于计算机硬件性能的考虑。

## 投射操作符
投射操作符语法：(type)expression，将表达式投射成指定的类型。投射过程不会改变原对象，而会创建一个新的临时对象，并将其赋值给新的变量。

投射表达式不能当左值。

c11对投射操作符的约束：
1. 用于投射操作的类型名应该指定一个标量类型，即非数组类型，并且可以在该类型前添加_Atomic、const、volatile等限定符。
2. 涉及指针类型的转换，除了允许隐式指针转换的情况，应该显示使用投射操作
3. 指针类型和浮点数不能相互转换。

## 逗号操作符
形式：`a,b,c`，其中a,b,c可以是任意表达式。**逗号表达式将若干表达式按照指定次序执行，返回最右边的表达式的值。**

需要注意，逗号表达式的优先级是最低的，一般要用括号括起来。