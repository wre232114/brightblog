---
title: 1.C语言中的基本元素
date: 2019-06-11 22:32:17
tags:
- 编程语言
- C语言
- 《C语言编程魔法书》

category:
- 编程语言
- C语言
---
一个基本C语言程序包含如下几个部分：
* 注释，有单行注释和多行注释。注释部分在预编译处理后就不存在了
* 预处理器
* 入口函数main
* 自定义的函数

C语言的头文件用.h结尾，源文件用.c结尾。

## C语言中的字符集
基本上所有语言的字符集都分为两种，一种是`源字符集`，一种是`执行字符集`。
* 源字符集：编写代码时候用的字符集
* 执行字符集：构建完源程序之后的目标二进制文件表示的字符集

例如java的源代码文件可能用utf-8编码，但是读入编译器后，使用的是UTF-16，也就是到执行时，一个字符起码占两个字节。

C语言标准允许C语言实现采用多字节字符集。但是是否能够使用多字节字符集进行编码，需要根据编译器的支持程度来看。

## C语言中的Token
token表示词法元素，输入的源文件会被编译器解释成一个个的token，在这些token上再进行语法分析。

C语言标准中定义token和预处理token，分别用于在编译时和预编译时的符号解析。根据预处理的规则，有一些token会在预处理时被处理掉，根据规则来定，所以下面会有重的，字符串可以在预处理中被替换，也可以是字面常量赋值给变量。
* token：关键词、标识符、常量、字符串字面量和标点符号
* 预处理token：头文件名、标识符、预处理数、字符常量、字符串字面量、标点符号以及空白符号

### 标识符
一个标识符由字母、数字、下划线组成，不能由数字开头。（有的C语言实现可以使用多字节字符作为标识符，例如GCC就支持）。C语言标准没有给出标识符的最大长度，但是具体实现上，标识符是64个字符，外部链接是32个字符（来自《C primer》），低版本编译器的实现可能更少。

### 关键字
数据类型：int、short、long、signed、unsigned、char、float、double、union、struct、enum、_Bool、_Complex、_Imaginary、void
循环控制：while、do、while、for、break、continue
分支控制：if、else、switch、case、goto、default、return
变量声明：static、const、register、volatile、const、extern、inline、auto、restrict、typedef、_Aalignas、_Atomic、_Noreturn、_Thread_local

### C语言中字面量
四种字面量：
* 整数、浮点数、枚举、字符和字符串字面量

例如：1，1.1，'A'，"中文"。

字符串前可以加上u8或者u或者U来使用utf8或者utf16或者utf32编码方式：
```c
const char* s1 = "hello, world!"; // 默认编码方式
const char* s2 = u8"hello, world!"; // 采用utf-8编码
const char* s3 = "你好，世界"; 
const char* s4 = u8"你好，世界";
const char* s5 = u"你好，世界"; // 采用utf-16编码，返回unsigned short*

printf("%s %d\n", s1, strlen(s1)); // hello world! 13
printf("%s %d\n", s2, strlen(s2)); // hello world! 13
printf("%s %d\n", s3, strlen(s3)); // 你好，世界 15
printf("%s %d\n", s4, strlen(s4)); // 你好，世界 15
printf("%s %d\n", s5, sizeof s5);  // 报错，u会转成unsigned short*
```
gcc编译时，会按照c文件的编码进行编码，因为我们的源文件是utf-8编码，所以里面的中文会按照utf-8编码被gcc处理，所以s3和s4在内存中都是15个字节（大部分utf-8编码的中文都是一个字符占3个字节，示例中5个字符）。都能正常显示中文。如果控制台显示乱码，那么需要查看控制台输出的编码方式，输入locale命令可以查看。

使用u或U会把字符串转成unsigned short数组指针或者unsigned int数组指针，u8会将字符串字面量存储为char*。

### C语言中的标点符号
单目运算符：!、&（用于地址操作符）、*（作为间接操作符）、+（正数符号）、-（负数符号）、～（按位取反）、++、--

双目运算符：
* 算术运算，+、-、*、/、%、=
* 逻辑运算，&&、||、<、>、==、!=
* 位运算，<<、>>、 &、|、^
* 预处理：#、##
* 组合运算，+=、-=、*=、/=、%=、<<=、>>=、&=、|=、^=

三目运算符：?  :，例如a?b:c;

其他符号还有：, [] () . -> {} ; : ... <: <% %> %:

不同的操作符的优先级不同，同一个表达式中，优先级高的运算符优先运算，优先级相同的运算符从左到右运算。优先级从高到低：
1. 基本表达式：标识符、字面量、圆括号表达式、泛型表达式
2. 后缀操作符：数组下标、函数调用、.和->、++和--、(int[]){1,2,3}
3. 单目操作符：前缀++和--、&、正负取反等、sizeof、_Alignof等
4. 类型投射
5. 乘除取模
6. 加减
7. 左移右移
8. 关系操作符<、>、<=、>=
9. ==、!=
10. 按位与&
11. |
12. 按位异或^
13. &&
14. ||
15. ？:
16. =
17. ,

基本表达式优先级最高，复合表达式第二；单目>双目>三目、算术运算>移位运算>逻辑运算（<、>等）>(==等)>按位运算；

如果不知道优先级关系或者优先级关系复杂，加上圆括号、增强可读性确保不错。因为圆括号优先级属于最高的那一层。